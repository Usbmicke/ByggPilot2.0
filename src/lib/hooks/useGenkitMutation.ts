\nimport \'client-only\';\nimport { useState } from \'react\';\nimport { runFlow } from \'@genkit-ai/flow/client\';\nimport { useAuth } from \'@/lib/auth/AuthProvider\';\n\n// ===================================================================\n// Callback-typer för Mutation\n// ===================================================================\n\ninterface MutationCallbacks<O> {\n  onSuccess?: (data: O) => void;\n  onError?: (error: Error) => void;\n  onSettled?: () => void;\n}\n\n// ===================================================================\n// useGenkitMutation (för Skriv-operationer)\n// ===================================================================\n// En specialiserad hook för mutationer (create, update, delete).\n// Den använder inte SWR eftersom vi inte vill cacha resultatet av en POST.\n// Istället hanterar den manuellt anrops-status (isPending, error).\n// ===================================================================\n\nexport function useGenkitMutation<I, O>(\n  flowId: string\n) {\n  const { idToken } = useAuth();\n  const [isPending, setIsPending] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  const mutate = async (input: I, callbacks: MutationCallbacks<O> = {}) => {\n    // Skyddsnät: Kasta ett tydligt fel om idToken saknas.\n    if (!idToken) {\n      const authError = new Error(\'Authentication token not found. Please ensure you are logged in.\');\n      console.error(\'Mutation failed:\', authError);\n      setError(authError);\n      callbacks.onError?.(authError);\n      return;\n    }\n\n    setIsPending(true);\n    setError(null);\n\n    try {\n      const result = await runFlow<I, O>(flowId, input, {\n        endpoint: \'/api/genkit\',\n        headers: {\n          Authorization: `Bearer ${idToken}`,\n        },\n      });\n\n      console.log(`Mutation \`${flowId}\` successful:`, result);\n      callbacks.onSuccess?.(result);\n      return result;\n    } catch (e: any) {\n      console.error(`Mutation \`${flowId}\` failed:`, e);\n      setError(e);\n      callbacks.onError?.(e);\n    } finally {\n      setIsPending(false);\n      callbacks.onSettled?.();\n    }\n  };\n\n  return { mutate, isPending, error };\n}\n